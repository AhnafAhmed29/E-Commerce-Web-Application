{% extends "base.html" %}
{% block title %}Shopping Cart - EZ Gadgets{% endblock %}
{% block content %}
<div class="container" style="margin: 40px auto;">
    <h1 style="margin-bottom: 30px;">Shopping Cart</h1>
    {% if cart and cart.items.count() > 0 %}
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
        <div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f8f8f8;">
                    <tr>
                        <th style="padding: 15px; text-align: left;">PRODUCT</th>
                        <th style="padding: 15px; text-align: center;">SUBTOTAL</th>
                        <th style="padding: 15px;"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart.items %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 20px;">
                            <div style="display: flex; gap: 20px; align-items: center;">
                                <img src="{{ item.product.main_image or 'https://via.placeholder.com/100' }}" style="width: 100px; height: 100px; object-fit: contain; background: #f8f8f8; padding: 10px;">
                                <div>
                                    <h3 style="margin-bottom: 5px;">{{ item.product.name }}</h3>
                                    <p style="color: #666; margin: 5px 0;">৳ {{ "%.2f"|format(item.product.price) }}</p>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                        <button onclick="updateQuantity({{ item.id }}, -1)" style="border: 1px solid #ddd; background: #fff; padding: 5px 10px; cursor: pointer;">-</button>
                                        <input type="number" value="{{ item.quantity }}" min="1" max="{{ item.product.stock }}" id="qty-{{ item.id }}" style="width: 60px; text-align: center; border: 1px solid #ddd; padding: 5px;">
                                        <button onclick="updateQuantity({{ item.id }}, 1)" style="border: 1px solid #ddd; background: #fff; padding: 5px 10px; cursor: pointer;">+</button>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 20px; text-align: center; font-weight: bold;">৳ {{ "%.2f"|format(item.get_subtotal()) }}</td>
                        <td style="padding: 20px; text-align: right;">
                            <a href="{{ url_for('remove_from_cart', item_id=item.id) }}" style="color: #d9534f; font-size: 1.5rem;">×</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div>
            <div style="background: #f8f8f8; padding: 25px; border-radius: 8px;">
                <h2 style="margin-bottom: 20px;">Your Order</h2>
                <div style="border-bottom: 1px solid #ddd; padding-bottom: 15px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Subtotal</span>
                        <strong>৳ {{ "%.2f"|format(cart.get_total()) }}</strong>
                    </div>
                </div>
                <div style="border-bottom: 1px solid #ddd; padding-bottom: 15px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Shipping</span>
                        <span>Flat rate: ৳ 60.00</span>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 1.2rem; font-weight: bold;">
                    <span>Total</span>
                    <span>৳ {{ "%.2f"|format(cart.get_total() + 60) }}</span>
                </div>
                <a href="{{ url_for('checkout') }}" class="btn btn-primary" style="width: 100%; padding: 15px; text-align: center; display: block;">Place Order</a>
            </div>
        </div>
    </div>
    {% else %}
    <div style="text-align: center; padding: 60px;">
        <h2 style="color: #999;">Your cart is empty</h2>
        <a href="{{ url_for('products') }}" class="btn btn-primary" style="margin-top: 20px;">Continue Shopping</a>
    </div>
    {% endif %}
</div>
<script>
function updateQuantity(itemId, change) {
    const input = document.getElementById('qty-' + itemId);
    let newQty = parseInt(input.value) + change;
    if (newQty < 1) newQty = 1;
    if (newQty > parseInt(input.max)) newQty = parseInt(input.max);
    input.value = newQty;
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/cart/update/' + itemId;
    const qtyInput = document.createElement('input');
    qtyInput.name = 'quantity';
    qtyInput.value = newQty;
    form.appendChild(qtyInput);
    document.body.appendChild(form);
    form.submit();
}
</script>
{% endblock %}
